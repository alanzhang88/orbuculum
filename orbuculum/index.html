<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>Orbuculum</title>
    <!-- This index.html file contains two shader programs that renders the crystall ball based on environment map generated from Google Streetveiw API

    Reference: http://math.hws.edu/eck/cs424/notes2013/webgl/skybox-and-reflection/skybox-and-env-map.html

    -->
    <!-- Shaders for SkyBox -->
    <script type="x-shader/x-vertex" id="vshaderBox">
        uniform mat4 projection;
        uniform mat4 modelview;
        attribute vec3 coords;
        varying vec3 vcoords;
        void main() {
            vec4 eyeCoords = modelview * vec4(coords, 1.0);
            gl_Position = projection * eyeCoords;
            vcoords = coords;// normalized already
        }
    </script>
    <script type="x-shader/x-fragment" id="fshaderBox">
        precision mediump float;
        varying vec3 vcoords;
        uniform samplerCube skybox;
        void main() {
            gl_FragColor = textureCube(skybox, vcoords);
        }
    </script>
    <!-- Shaders for Ball -->
    <script type="x-shader/x-vertex" id="vshader">
        uniform mat4 projection;
        uniform mat4 modelview;
        attribute vec3 coords;
        attribute vec3 normal;
        varying vec3 viewCoords;
        varying vec3 vNormal;
        void main() {
            vec4 eyeCoords = modelview * vec4(coords, 1.0);
            gl_Position = projection * eyeCoords;
            viewCoords = eyeCoords.xyz;
            vNormal = normal;
        }
    </script>
    <script type="x-shader/x-fragment" id="fshader">
        precision mediump float;
        varying vec3 vNormal;
        varying vec3 viewCoords;
        uniform samplerCube skybox;
        uniform mat3 normalMV; // normal matrix of modelview matrix
        uniform mat3 invMV;
        void main() {
            // vec3 N = normalMV * vNormal;
            // vec3 V = -viewCoords;
            // vec3 R = V - 2.0 * dot(V,N) * N;
            // R = invMV * R; // transform it back to model coordinates
            // R = normalize(R);
            // gl_FragColor = textureCube(skybox, R);

            vec3 N = normalize(normalMV * vNormal);
            vec3 V = -viewCoords;
            vec3 R = -reflect(V,N);
            vec3 T = invMV * R; // Transform by inverse of the view transform that was applied to the skybox
            gl_FragColor = textureCube(skybox, T);
            // gl_FragColor = vec4(vNormal.z,0,-vNormal.z, 1.0);
            // gl_FragColor = vec4(1.0,0.0,0.0,1.0);
        }
    </script>
    <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <h1> Project Orbuculum </h1>
        <section class="canvas-wrapper">
            <canvas width=100% height=70% id="glcanvas" style="background-color:black"></canvas>
            <p id="message" style="font-weight:bold"></p>
        </section>
        <section class="map-wrapper">
            <div id="map" tabindex="0"></div>
            <div id="pac-container" >
                <input id="pac-input" type="text" placeholder="Enter a location" >
            </div>
        </section>
        <div class="browser-landing" id="main">
        <div class="compact marquee">
            <div id="info">
            <p id="info_start">
                Orbuculum, show me...
            </p>
            <p id="info_speak_now" style="display:none">
                Speak now.
            </p>
            <p id="info_no_speech" style="display:none">
                No speech was detected. You may need to adjust your
                settings</a>.
            </p>
            <p id="info_no_microphone" style="display:none">
                No microphone was found. Ensure that a microphone is installed and that
                microphone settings</a> are configured correctly.
            </p>
            <p id="info_allow" style="display:none">
                Click the "Allow" button above to enable your microphone.
            </p>
            <p id="info_denied" style="display:none">
                Permission to use microphone was denied.
            </p>
            <p id="info_blocked" style="display:none">
                Permission to use microphone is blocked. To change, go to
                chrome://settings/contentExceptions#media-stream
            </p>
            <p id="info_upgrade" style="display:none">
                Web Speech API is not supported by this browser. Upgrade to
            </p>
            </div>
            <div id="div_start">
            <button id="start_button" onclick="startButton(event)"><img alt="Start" id="start_img"
            src="image/mic.gif"></button>
            </div>
            <div id="results">
            <span class="final" id="final_span"></span> <span class="interim" id=
            "interim_span"></span>
            </div>
        </div>
        </div>

        <script
        src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
        crossorigin="anonymous"></script>
        <script type="text/javascript" src="lib/webgl-debug.js"></script>
        <script type="text/javascript" src="lib/gl-matrix-min.js"></script>
        <script type="text/javascript" src="lib/objects.js"></script>
        <script type="text/javascript" src="lib/utils.js"></script>
        <script type="text/javascript" src="lib/simple-rotator.js"></script>
        <script type="text/javascript" src="lib/retrieve-img.js"></script>
        <script type="text/javascript" src="lib/StackBlur.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCSIanF_npOtptuVIacA2WBfJ3dADCJDM&libraries=places"></script>
        <script type="text/javascript" src="main.js"></script>
        <script src="lib/voice.js"></script>
    </body>
</html>