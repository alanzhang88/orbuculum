<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>Orbuculum</title>
    <!-- This index.html file contains two shader programs that renders the crystall ball based on environment map generated from Google Streetveiw API

    Reference: http://math.hws.edu/eck/cs424/notes2013/webgl/skybox-and-reflection/skybox-and-env-map.html

    -->
    <!-- Shaders for SkyBox -->
    <script type="x-shader/x-vertex" id="vshaderBox">
        uniform mat4 projection;
        uniform mat4 modelview;
        attribute vec3 coords;
        varying vec3 vcoords;
        void main() {
            vec4 eyeCoords = modelview * vec4(coords, 1.0);
            gl_Position = projection * eyeCoords;
            vcoords = coords;// normalized already
        }
    </script>
    <script type="x-shader/x-fragment" id="fshaderBox">
        precision mediump float;
        varying vec3 vcoords;
        uniform samplerCube skybox;
        void main() {
            // gl_FragColor = textureCube(skybox, vcoords);
            gl_FragColor = vec4(1.0,0.0,0.0,1.0);
        }
    </script>
    <!-- Shaders for Ball -->
    <script type="x-shader/x-vertex" id="vshader">
        uniform mat4 projection;
        uniform mat4 modelview;
        attribute vec3 coords;
        attribute vec3 normal;
        varying vec3 viewCoords;
        varying vec3 vNormal;
        void main() {
            vec4 eyeCoords = modelview * vec4(coords, 1.0);
            gl_Position = projection * eyeCoords;
            viewCoords = eyeCoords.xyz;
            vNormal = normal;
        }
    </script>
    <script type="x-shader/x-fragment" id="fshader">
        precision mediump float;
        varying vec3 vNormal;
        varying vec3 viewCoords;
        uniform samplerCube skybox;
        uniform mat3 normalMV; // normal matrix of modelview matrix
        uniform mat3 invMV;
        void main() {
            vec3 N = normalMV * vNormal;
            vec3 V = viewCoords;
            vec3 R = V - 2.0 * dot(V,N) * N;
            R = invMV * R; // transform it back to model coordinates
            gl_FragColor = textureCube(skybox, R);
            // gl_FragColor = vec4(1.0,0.0,0.0,1.0);
        }
    </script>
    </head>
    <body style="background-color: #EEE">
        <h2> Project Orbuculum </h2>
        <noscript><hr><h3>This page requires Javascript and a web browser that supports WebGL</h3><hr></noscript>
        <div>
            <canvas width=1400 height=800 id="glcanvas" style="background-color:black"></canvas>
        </div>
        <p id="message" style="font-weight:bold"></p>

        <script type="text/javascript" src="lib/webgl-debug.js"></script>
        <script type="text/javascript" src="lib/gl-matrix-min.js"></script>
        <script type="text/javascript" src="lib/objects.js"></script>
        <script type="text/javascript" src="lib/requestAnimationFrame.js"></script>
        <script type="text/javascript" src="main.js"></script>

    </body>
</html>